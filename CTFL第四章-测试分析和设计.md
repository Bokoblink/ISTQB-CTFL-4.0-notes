## 4. 测试分析和设计

### 4.1 测试技术概述

- 支持测试人员开展测试分析（测试什么）和测试设计（如何测试）
- 术有助于以系统的方式开发相对较小但充分的测试用例集
- 在测试分析和设计期间帮助测试人员定义测试条件、识别覆盖项，并识别测试数据
- 黑盒测试技术
  - 也称为基于规格说明的技术
  - 基于对测试对象的特定行为进行分析，而不考虑其内部结构
  - 测试用例不依赖于软件的实现方式
- 白盒测试技术
  - 也称为基于结构的技术
  - 基于对测试对象的内部结构和处理进行分析
  - 由于测试用例依赖于软件的设计方式，因此白盒测试只能在测试对象的设计或实现之后创建
- 基于经验的测试技术
  - 有效地利用测试人员的知识和经验进行测试用例的设计和实施
  - 有效性在很大程度上取决于测试人员的技能
  - 能检测出使用黑盒和白盒测试技术可能会遗漏的缺陷
  - 是对黑盒和白盒测试技术的补充

### 4.2 黑盒测试技术

#### 4.2.1 等价类划分

- 基于给定分区中的所有元素都会被测试对象以相同方式处理的预期将数据划分为多个分区（称为等价类）
- 原理：如果测试用例测试了等价类中的一个值，并检测到缺陷，那么任何来自同一等价类的其他值的测试用例也应该能够检测到这个缺陷。因此，每个分区执行一个测试就足够了
- 分可应用于与测试对象相关的任何数据元素，包括输入、输出、配置项、内部值、与时间相关的值和接口参数
- 可以是连续的或离散的、有序的或无序的、有限的或无限的
- 不能重叠，并且必须是非空集合
- 有效等价类、无效等价类
  - 包含有效值的分区称为有效等价类
  - 包含无效值的分区称为无效等价类
- 在等价类划分中，覆盖项是等价类划分
  - 覆盖率是由被测试用例执行的等价类数量，除以已确定的等价类总数来度量的，并以百分比表示
- 单选项覆盖、多组等价类
  - 许多测试对象包括多组等价类分区，这意味着一个测试用例将覆盖来自不同等价类组的等价类
  - 在多组等价类情况下，最简单的覆盖准则被称为单选项覆盖
  - 单选项覆盖要求测试用例执行来自每个等价类组的每个等价类至少一次

#### 4.2.2 边界值分析

- 边界值分析（BVA）是基于执行等价类边界的技术
- 边界值分析只能用于有序分区
- 分区的最小值和最大值是它的边界值
- 如果两个元素属于同一个分区，那么它们之间的所有元素也必须属于该分区。
- 侧重于分区的边界值，因为开发人员更容易在这些边界值上出错
- 二值边界值和三值边界值分析
  - 二值边界值分析
    - 每个边界值都有两个覆盖项：该边界值以及属于相邻分区的最近邻值
    - 测试用例必须执行所有的覆盖项，即所有已识别的边界值
    - 覆盖率是由已被执行的边界值的数量，除以已识别的边界值总数度量，并以百分比表示
  - 三值边界值分析
    - 每个边界值都有三个覆盖项
    - 该边界值以及两侧的相邻值
    - 某些覆盖项可能不是边界值
    - 测试用例必须执行所有的覆盖项，即已识别的边界值及其相邻值
    - 覆盖率是由已被执行的边界值及其相邻值的数量，除以已识别的边界值及其相邻值的总数度量，并以百分比表示

#### 4.2.3 判定表测试

- 是什么
  - 判定表用于测试系统需求的实现，这些需求指定了不同的条件组合产生不同的结果
  - 是记录复杂逻辑（如业务规则）的有效方法
- 创建判定表
  - 定义了系统的条件和导致的动作，这些组成了判定表的行
  - 判定表的每一列对应了一个判定规则，该规则定义了各种条件的唯一组合以及相关的动作
  - 在有限判定表中，所有条件和动作的值表示为布尔值（“真”或“假”）
  - 在扩展判定表中，某些或者所有条件和动作也可以采用多个值
- 条件的符号
  - “T”（true）表示满足条件
  - “F”（false）表示不满足条件
  - “-”表示条件的取值与动作结果不相关
  - “N/A”表示该条件对于给定的规则是不可行的
  - 动作中
    - “X”表示动作应该发生
    - 空白表示动作不应该发生
  - 也可以使用其他符号
- 完全的判定表有足够多的列来覆盖条件的每种组合
- 判定表测试
  - 覆盖项是包含可行条件组合的列
  - 为了让这种技术达到 100%的覆盖率，测试用例必须执行所有这些列
  - 覆盖率是由已被执行的列数量，除以可执行列的总数度量，并以百分比表示
- 优点
  - 提供了系统化的方法来识别所有的条件组合，否则其中的某些组合可能会被忽视
  - 有助于发现需求中的任何漏洞或不一致
- 如果有很多条件，那么执行所有判定规则可能比较耗时，因为规则的数量会随着条件的数量呈指数增长
  - 为了减少需要执行的规则的数量，可以使用最小化判定表或基于风险的方法

#### 4.2.4 状态转移测试

- 是什么
  - 状态转移图通过显示系统可能的状态和有效的状态转移来模拟系统的行为
  - 转移由事件触发，该事件可能由守护条件进一步限定
  - 假设转移是瞬时的，有时可能导致软件采取动作
  - 常见的转移标签语法：“事件 [守护条件] / 动作”
- 状态表
  - 是等价于状态转移图的一种模型
  - 行表示状态，列表示事件（可能还包括守护条件）
  - 状态表条目（单元格）表示转移，并包含目标状态以及结果动作（如果已定义）
  - 与状态转移图相反，状态表通过空白单元格明确显示无效的转移
- 测试用例
  - 基于状态转移图或状态表的测试用例通常表示为事件序列，这些事件会导致一系列的状态变化（和动作，如果需要）
  - 一个测试用例可以并且通常会覆盖状态之间的若干次转移
- 覆盖准则
  - 全状态覆盖
    - 覆盖项是状态
    - 为了达到 100%的全状态覆盖率，测试用例必须确保所有状态都被访问到
    - 覆盖率是由已被访问的状态数量，除以状态总数度量，并以百分比表示
  - 有效转移覆盖
    - 覆盖项是单个有效转移
    - 为了达到 100%的覆盖率，测试用例必须执行所有的有效转移
    - 覆盖率是由已被执行的有效转移的数量，除以有效转移的总数度量，并以百分比表示
  - 全转移覆盖中
    - 覆盖项是状态表中显示的所有转移
    - 为了达到 100%的全转移覆盖率，测试用例必须执行所有的有效转移，并尝试执行无效转移
    - 在单个测试用例中仅测试一个无效转移有助于避免错误屏蔽，即一个缺陷阻止另一个缺陷被发现的情况。
    - 覆盖率是由已执行的测试用例所覆盖的执行有效转移和尝试无效转移的数量，除以有效和无效转移的总数度量，并以百分比表示
  - 全状态覆盖弱于有效转移覆盖，因为它通常可以在不执行所有转移的情况下达到
  - 有效转移覆盖是最广泛使用的覆盖准则
  - 达到完整的有效转移覆盖可保证完整的全状态覆盖
  - 达到完整的全转移覆盖可同时保证完整的全状态覆盖和完整的有效转移覆盖，并且应该是关键任务和安全关键软件的最低要求

### 4.3 白盒测试技术

#### 4.3.1 语句测试和语句覆盖

- 覆盖项是可执行语句
- 目的是设计测试用例，通过执行代码中的语句，直到达到可接受的覆盖率级别
- 覆盖率是用测试用例执行的语句数除以代码中可执行语句的总数度量，并以百分比表示
  - 达到 100%语句覆盖率时，能确保代码中的所有可执行语句至少已被执行过一次
  - 带有缺陷的每条语句将被执行到，这可能导致失效，从而证明缺陷的存在
  - 使用测试用例执行语句不能在所有的情况下都检测到缺陷
  - 100%的语句覆盖率不能确保所有的判定逻辑都被测试过

#### 4.3.2 分支测试和分支覆盖

- 覆盖项是分支
- 目的是设计测试用例，以执行代码中的分支，直到达成可接受的覆盖率级别为止
- 覆盖率是用测试用例执行的分支数除以分支总数度量，并以百分比表示
- 当达到 100%的分支覆盖时，代码中的所有分支，都被测试用例执行
  - 使用测试用例来执行分支并不能在所有情况下都检测到缺陷
- 分支覆盖包含语句覆盖
- 如果实现了 100%的分支覆盖率，也就实现了 100%的语句覆盖率（但反之不成立）

#### 4.3.3 白盒测试的价值

- 优点：在测试期间考虑到整个软件实现，有助于在软件规格说明模糊、过时或不完整时检测缺陷
- 弱点：如果软件没有实现一个或多个需求，白盒测试可能无法检测到由此产生的遗漏缺陷
- 用于
  - 白盒技术可用于静态测试
  - 适合于对尚未准备好执行的代码进行评审，以及伪代码和其他可以用控制流图建模的高层逻辑或自顶向下的逻辑
- 作用
  - 仅执行黑盒测试不能提供实际代码覆盖率的度量
  - 白盒覆盖率的度量数据提供了客观的覆盖率度量，并提供了必要的信息，以允许生成额外的测试来提高覆盖率，从而增加对代码的信心

### 4.4 基于经验的测试技术

#### 4.4.1 错误猜测

- 基于测试人员的知识来预测错误、缺陷和失效发生的技术
  - 以前软件的运行方式
  - 开发人员常犯的错误类型以及由这些错误导致的缺陷类型
  - 其他类似应用软件产生的失效类型
- 故障攻击
  - 实现错误猜测的一种系统方法
  - 要求测试人员创建或获取一份可能的错误、缺陷和失效列表，并设计测试来识别与缺陷相关的错误、暴露缺陷、或导致失效
  - 这些列表可以基于经验、缺陷和失效数据，或者基于软件失败原因的常识来构建

#### 4.4.2 探索性测试

- 在了解有关测试对象的同时，设计、执行和评估测试
- 用于更深入地了解测试对象，使用重点测试进行深入探索，并为未测试的区域创建测试
- 有时使用基于会话的测试来构建
  - 在基于会话的方法中，探索性测试在定义的时间盒内进行
  - 测试人员使用包含测试目的的测试章程来指导测试
  - 测试会话之后通常会汇报，包括测试人员和对测试会话的测试成果感兴趣的利益相关方之间的讨论
  - 在这种方法中，测试目的可被视为高级别的测试条件
  - 在测试会话期间，识别并执行覆盖项
  - 测试人员可以使用测试会话表格来记录所执行的步骤和发现的内容
- 用处
  - 在规格说明文档较少或不充分时，或测试的时间压力大的情况下很有帮助
  - 有助于作为对其他更正式测试技术的补充
- 如果测试人员经验丰富，具备领域知识，并具备较高的基本技能，探索性测试将更加有效

#### 4.4.3 基于检查表的测试

- 测试人员设计、实施和执行测试以覆盖检查表中的测试条件
- 可以基于经验、对用户重要的知识，或者对软件失效原因和方式的理解来构建
- 表不应包含可以自动检查的项、更适合作为入口/出口准则的项或过于笼统的项
- 检查表的项
  - 通常以问题的形式表述
  - 每个项应该可以单独和直接地进行检查
  - 这些项可以涉及需求、图形界面属性、质量特性或其他形式的测试条件
  - 可以创建检查表支持各种测试类型，包括功能和非功能性测试
- 应根据缺陷分析定期更新检查表
- 在缺乏详细的测试用例的情况下，基于检查表的测试可以为测试提供指南和某种程度的一致性

### 4.5 基于协作的测试方法

#### 4.5.1 协作用户故事编写

- 用户故事代表对系统或软件的用户或购买者有价值的特征
- 三个关键方面
  - 卡片
    - 描述用户故事的媒介（例如索引卡、电子板中的条目）
  - 对话
    - 解释软件的使用方式（可以是文档化或口头形式）
  - 确认
    - 验收准则
- 协作编写用户故事可以使用头脑风暴和思维导图等技术
- 通过协作，同时兼顾到业务、开发和测试三个视角，团队可以共同理解应该交付的内容和共享愿景
- 好的用户故事
  - 独立的
  - 可协商的
  - 有价值的
  - 可评估的
  - 小巧的
  - 可测试的
- 如果利益相关方不知道如何对用户故事进行测试，可能说明用户故事不够清晰，或者没有反映出有价值的内容，或者利益相关方需要在测试方面得到帮助

#### 4.5.2 验收准则

- 用户故事的验收准则是实现用户故事必须满足的条件，以便被利益相关方接受
- 验收准则可以被视为测试应该覆盖的测试条件
- 验收准则通常是对话的结果
- 用于
  - 定义用户故事的范围
  - 利益相关方之间达成共识
  - 描述正向和反向场景。
  - 作为用户故事验收测试的依据
  - 实现准确规划和估算
- 编写用户故事的验收准则有几种方式。最常见的两种格式是：
  - 面向场景
  - 面向规则

#### 4.5.3 验收测试驱动开发(ATDD)

- 是什么
  - ATDD 是测试先行（test-first）的一种方法
  - 测试用例在实现用户故事之前创建
  - 测试用例由具有不同视角的团队成员创建，例如客户、开发人员和测试人员
  - 测试用例可以人工或自动化执行
- 步骤
  1. 进行规格说明讨论会
     - 团队成员分析、讨论和编写用户故事及其验收准则
     - 在此过程中解决了用户故事中的不完整、模糊或缺陷
  2. 创建测试用例
     - 可以由整个团队或测试人员单独完成
     - 测试用例基于验收准则，并且视为软件运行方式的实例
     - 有助于团队正确实现用户故事
- 测试过程
  - 通常，第一批测试用例是正向测试，确认在没有异常或错误条件下的正确行为，并包括按照预期执行的活动序列
  - 在完成正向测试用例后，团队应进行反向测试
  - 最后，团队还应涵盖非功能质量特性（例如性能效率、易用性）
  - 测试用例应以利益相关方可以理解的方式进行描述
  - 通常，测试用例包含自然语言形式的句子，包括必要的前提条件（如果有），输入和后置条件
- 测试用例必须覆盖用户故事的所有特性，并且不应超出故事范围
- 不过，验收准则可能详细描述用户故事中描述的一些问题
- 此外，任何两个测试用例都不应该描述用户故事的相同特性
- 当以测试自动化框架支持的格式进行捕获时，开发人员可以在实现用户故事描述的特征时编写支持代码，从而自动化测试用例。验收测试就成为可执行的需求